# Journal Entry Types Reference

This document describes the TypeScript types used for journal entries in the double-entry bookkeeping system.

---

## Table of Contents

- [JournalEntry](#journalentry)
- [JournalLine](#journalline)
- [JournalEntryInput](#journalentryinput)
- [EntryMetadata](#entrymetadata)
- [TrialBalance](#trialbalance)
- [TrialBalanceEntry](#trialbalanceentry)
- [AccountHistoryEntry](#accounthistoryentry)
- [LedgerSnapshot](#ledgersnapshot)

---

## JournalEntry {#journalentry}

An immutable, posted journal entry in the ledger.

```typescript
interface JournalEntry {
  /** Unique identifier (e.g., "je_abc123") */
  id: string;
  
  /** Array of debit and credit lines */
  lines: JournalLine[];
  
  /** Entry metadata (description, date, reference, tags) */
  metadata: EntryMetadata;
  
  /** SHA-256 hash of entry content */
  hash: string;
  
  /** Hash of the previous entry (null for first entry) */
  previousHash: string | null;
  
  /** Whether this entry has been voided */
  isVoided: boolean;
  
  /** ID of the reversing entry (if voided) */
  voidedBy?: string;
  
  /** ID of the original entry (if this is a reversing entry) */
  voids?: string;
}
```

### Properties

| Property | Type | Description |
|----------|------|-------------|
| `id` | `string` | Unique entry identifier |
| `lines` | `JournalLine[]` | Debit and credit lines |
| `metadata` | `EntryMetadata` | Description, date, reference, tags |
| `hash` | `string` | SHA-256 hash for integrity verification |
| `previousHash` | `string \| null` | Previous entry's hash (creates chain) |
| `isVoided` | `boolean` | Whether entry has been voided |
| `voidedBy` | `string \| undefined` | ID of reversing entry |
| `voids` | `string \| undefined` | ID of entry this reverses |

### Example

```typescript
const entries = ledger.getJournalEntries();
const entry = entries[0];

console.log(entry.id);           // "je_1706..."
console.log(entry.lines.length); // 2
console.log(entry.hash);         // "a1b2c3..."
console.log(entry.isVoided);     // false
```

---

## JournalLine {#journalline}

A single line in a journal entry representing a debit or credit.

```typescript
interface JournalLine {
  /** Account to debit or credit */
  accountId: string;
  
  /** Amount for this line */
  amount: Money;
  
  /** Whether this is a debit or credit */
  type: "debit" | "credit";
  
  /** Optional line-level memo */
  memo?: string;
}
```

### Properties

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `accountId` | `string` | ✅ | Target account ID |
| `amount` | `Money` | ✅ | Entry amount |
| `type` | `"debit" \| "credit"` | ✅ | Entry type |
| `memo` | `string` | ❌ | Line-level note |

### Example

```typescript
const lines: JournalLine[] = [
  { 
    accountId: "cash", 
    amount: Money.fromMajor("500", "USD"), 
    type: "debit",
    memo: "Payment received"
  },
  { 
    accountId: "accounts-receivable", 
    amount: Money.fromMajor("500", "USD"), 
    type: "credit",
    memo: "Invoice #1001 paid"
  },
];
```

---

## JournalEntryInput {#journalentryinput}

Input for creating a new journal entry.

```typescript
interface JournalEntryInput {
  /** Array of debit and credit lines */
  lines: JournalLine[];
  
  /** Entry metadata */
  metadata: EntryMetadata;
}
```

### Example

```typescript
ledger.post({
  lines: [
    { accountId: "cash", amount: Money.fromMajor("500", "USD"), type: "debit" },
    { accountId: "sales-revenue", amount: Money.fromMajor("500", "USD"), type: "credit" },
  ],
  metadata: {
    description: "Cash sale",
    reference: "INV-1001",
    tags: ["sales"],
  },
});
```

---

## EntryMetadata {#entrymetadata}

Metadata attached to a journal entry.

```typescript
interface EntryMetadata {
  /** Human-readable entry description */
  description: string;
  
  /** Entry date (defaults to current time) */
  date?: Date;
  
  /** External reference (invoice number, PO number, etc.) */
  reference?: string;
  
  /** Categorization tags for querying */
  tags?: string[];
}
```

### Properties

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `description` | `string` | ✅ | What this entry represents |
| `date` | `Date` | ❌ | Entry date (default: now) |
| `reference` | `string` | ❌ | External reference number |
| `tags` | `string[]` | ❌ | Query/filtering tags |

### Example

```typescript
const metadata: EntryMetadata = {
  description: "Monthly rent payment",
  date: new Date("2026-02-01"),
  reference: "CHK-5678",
  tags: ["rent", "recurring", "february"],
};
```

---

## TrialBalance {#trialbalance}

Trial balance report generated by `getTrialBalance()`.

```typescript
interface TrialBalance {
  /** Per-account balance entries */
  entries: TrialBalanceEntry[];
  
  /** Sum of all debit balances */
  totalDebits: Money;
  
  /** Sum of all credit balances */
  totalCredits: Money;
  
  /** Whether the ledger is balanced (debits = credits) */
  isBalanced: boolean;
  
  /** When this report was generated */
  generatedAt: Date;
}
```

### Example

```typescript
const tb = ledger.getTrialBalance();

if (!tb.isBalanced) {
  console.error("Ledger is out of balance!");
  console.log(`Debits: ${tb.totalDebits.format()}`);
  console.log(`Credits: ${tb.totalCredits.format()}`);
}
```

---

## TrialBalanceEntry {#trialbalanceentry}

A single account's entry in a trial balance.

```typescript
interface TrialBalanceEntry {
  /** Account identifier */
  accountId: string;
  
  /** Account display name */
  accountName: string;
  
  /** Account classification */
  accountType: AccountType;
  
  /** Debit balance (or zero) */
  debitBalance: Money;
  
  /** Credit balance (or zero) */
  creditBalance: Money;
}
```

### How Balances are Reported

For **debit-normal accounts** (asset, expense):
- Positive balance → appears in `debitBalance`
- Negative balance → appears in `creditBalance`

For **credit-normal accounts** (liability, equity, revenue):
- Positive balance → appears in `creditBalance`
- Negative balance → appears in `debitBalance`

### Example

```typescript
const tb = ledger.getTrialBalance();

for (const entry of tb.entries) {
  const dr = entry.debitBalance.format();
  const cr = entry.creditBalance.format();
  console.log(`${entry.accountName.padEnd(30)} ${dr.padStart(12)} ${cr.padStart(12)}`);
}
```

Output:
```
Cash                           $5,000.00           $0.00
Accounts Receivable            $2,500.00           $0.00
Accounts Payable                   $0.00       $1,500.00
Sales Revenue                      $0.00       $6,000.00
```

---

## AccountHistoryEntry {#accounthistoryentry}

A single entry in an account's transaction history.

```typescript
interface AccountHistoryEntry {
  /** Journal entry ID */
  entryId: string;
  
  /** Entry date */
  date: Date;
  
  /** Entry description */
  description: string;
  
  /** Debit amount (or zero) */
  debit: Money;
  
  /** Credit amount (or zero) */
  credit: Money;
  
  /** Running balance after this entry */
  runningBalance: Money;
}
```

### Example

```typescript
const history = ledger.getAccountHistory("cash");

console.log("Date       | Description          | Debit    | Credit   | Balance");
console.log("-----------|----------------------|----------|----------|----------");

for (const h of history) {
  const date = h.date.toLocaleDateString();
  const desc = h.description.substring(0, 20).padEnd(20);
  const dr = h.debit.format().padStart(8);
  const cr = h.credit.format().padStart(8);
  const bal = h.runningBalance.format().padStart(10);
  console.log(`${date} | ${desc} | ${dr} | ${cr} | ${bal}`);
}
```

Output:
```
Date       | Description          | Debit    | Credit   | Balance
-----------|----------------------|----------|----------|----------
2/1/2026   | Opening balance       | $10,000  |    $0.00 |  $10,000
2/5/2026   | Cash sale - Inv #10   |    $500  |    $0.00 |  $10,500
2/10/2026  | Rent payment          |    $0.00 |  $2,000  |   $8,500
```

---

## LedgerSnapshot {#ledgersnapshot}

Serializable snapshot of the entire ledger state.

```typescript
interface LedgerSnapshot {
  /** Ledger currency */
  currency: string;
  
  /** All accounts with their configurations */
  accounts: AccountSnapshot[];
  
  /** All journal entries */
  entries: JournalEntrySnapshot[];
  
  /** Snapshot timestamp */
  createdAt: string; // ISO 8601
  
  /** Monetra version that created this snapshot */
  version: string;
}
```

### Usage

```typescript
// Create snapshot
const snapshot = ledger.snapshot();

// Serialize to JSON
const json = JSON.stringify(snapshot, null, 2);

// Save to storage
await fs.writeFile("ledger-backup.json", json);

// Later: restore
const data = JSON.parse(await fs.readFile("ledger-backup.json", "utf-8"));
const restored = DoubleEntryLedger.fromSnapshot(data);

// Verify integrity
console.log(restored.verify()); // true
```

---

## Type Imports

All types are exported from the main package:

```typescript
import {
  JournalEntry,
  JournalLine,
  JournalEntryInput,
  EntryMetadata,
  TrialBalance,
  TrialBalanceEntry,
  AccountHistoryEntry,
  LedgerSnapshot,
  AccountType,
} from "monetra";
```
